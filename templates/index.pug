extends layout.pug

block content
  .col-lg-9.col-md-9
    <div data-include="https://ubermensch.netlify.app/test.txt"></div>
    h2 Synchronized Shitposting
    p.
      NeutralZone allows users to register channels where connected viewers 
      can watch videos from different video hosts and the playback is synchronized
      for all viewers in the channel. We are a free speech website and let rooms
      moderate themselves, provided they are not breaking US law.
    h3 Active Channels
    table.table.table-bordered.table-striped
      thead
        th Channel
        th # Connected
        th Now Playing
      tbody
        each chan in channels
          tr
            td: a(href=`/${channelPath}/${chan.name}`) #{chan.pagetitle} (#{chan.name})
            td= chan.usercount
            td= chan.mediatitle

    h3 Official Channels
    table.table.table-bordered.table-striped
      thead
        th Channel
        th Description
      tbody 
          tr
            td üçøKino
            td A repository of movies.
          tr
            td üí°Documentaries
            td A repository of documentaries.
          tr
            td Radio
            td A repository of music.
          tr
            td /SIG/
            td Self Improvement General, enriching lifestyle content.
          tr
            td /x/
            td Conspiracy and alien /x/ related content.

    h3 Help NeutralZone
    ul
      li
        strong Donate
        | &mdash; Send us money so we can pay <a href="$" target="_blank">hosting costs</a>.
      li
        strong Write
        | &mdash; Let us <a href="#" target="_blank">publish your original content</a>, helping grow the site's influence.
      li
        strong Share
        | &mdash; Share NeutralZone personally with your friends or post links on "social media".          
      li
        strong Bookmark
        | &mdash; Your ADHD brain can forget stuff. So Bookmark us today!
      
  .col-lg-3.col-md-3

      h3 Register
      form(role="form", action="/register", method="post", onsubmit="return verify()")
        input(type="hidden", name="_csrf", value=csrfToken)
        .form-group
          label.control-label(for="username") Username
          input#register-username.form-control(type="text", name="name", onkeyup="checkUsername()", maxlength="20")
          p#validate_username.text-danger.pull-right
        .form-group
          label.control-label(for="password") Password
          input#register-password.form-control(type="password", name="password", onkeyup="checkPasswords()")
          p#validate_password.text-danger.pull-right
        .form-group
          label.control-label(for="password_confirm") Confirm Password
          input#register-password-confirm.form-control(type="password", onkeyup="checkPasswords()")
          p#validate_confirm.text-danger.pull-right
        .form-group
          label.control-label(for="email") Email (optional)
          input#register-email.form-control(type="email", name="email")
          p#validate_email.text-danger.pull-right
        if hCaptchaSiteKey
          noscript
            .text-danger This website requires JavaScript in order to display a CAPTCHA.
          .form-group
            div.h-captcha(data-sitekey=hCaptchaSiteKey)
        button#registerbtn.btn.btn-success.btn-block(type="submit") Register


append footer
  if hCaptchaSiteKey
    script(src="https://hcaptcha.com/1/api.js" async defer)
  script(type="text/javascript").
    function verify() {
      var valid = checkUsername();
      valid = checkPasswords() && valid;
      valid = checkEmail() && valid;
      return valid;
    }
    function checkUsername() {
      function stateError(text){
        target.parent()
          .addClass("has-error")
          .removeClass("has-success");
        $("#validate_username").text(text);
      }
      var target = $("#register-username");
      var name = target.val();
      if (name === "") {
        stateError('Username must not be empty')
        return false;
      } else if (!(/^[-\w\u00c0-\u00ff]{1,20}$/).test(name)) {
        stateError("Username must consist of 1-20 characters" +
                    " a-Z, A-Z, 0-9, -, or _.");
        return false;
      } else {
        target.parent()
          .removeClass("has-error")
          .addClass("has-success");
        $("#validate_username").text('');
      }
    }
    function checkPasswords() {
      function stateError(text, target, validator){
        target.parent()
          .addClass("has-error")
          .removeClass("has-success");
        $(`#${validator}`).text(text);
      }
      var target = $("#register-password");
      var target2 = $("#register-password-confirm");
      var pw = target.val();
      var pwc = target2.val();

      $("#validate_password").text('');
      $("#validate_confirm").text('');
      if (pw === "") {
        stateError('Password must not be empty', target, 'validate_password')
        return false;
      } else {
        target.parent()
          .removeClass("has-error")
          .addClass("has-success");
        if (pw !== pwc) {
          stateError('Passwords do not match', target2, 'validate_confirm')
          return false;
        } else {
          target2.parent()
            .removeClass("has-error")
            .addClass("has-success");
        }
      }
    }
    function checkEmail() {
      var email = $("#register-email").val();
      if (email.trim() === "") {
        return confirm("Are you sure you want to register without setting a recovery email address?  If you lose the password, or if your account is compromised, you WILL NOT be able to recover it.");
      }
      return true;
    }
